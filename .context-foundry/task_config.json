{
  "task": "Build the \"ETop AM Intelligence System\" - a vendor-neutral Account Manager intelligence platform for MSPs.\n\n## Phase 1 MVP Requirements\n\n### Project Overview\nBuild a Sea-Level Ops-aligned QBR/vCIO system that generates quarterly business reviews, lifecycle plans, security posture reports, and outcome plans. This is PSA/RMM-agnostic with adapter pattern architecture.\n\n### Tech Stack\n- Node.js + Express\n- PostgreSQL for normalized data storage\n- OpenAI API for narrative generation\n- PDF generation library (PDFKit or similar)\n\n### Architecture (Critical Pattern)\n\n```\nAdapters \u2192 Normalized Data Layer \u2192 Insights Engine \u2192 Outputs\n```\n\n**Adapter Pattern Requirements:**\n- Each integration (PSA/RMM/Immy/M365) must be a separate adapter module\n- Adapters normalize data into common schema\n- Future adapters should plug in without touching core engine\n\n### Phase 1 Integrations\n\n1. **ConnectWise Manage Adapter**\n   - Pull: Agreements (MRR, effective rate), Tickets (count, category, time, SLA, reopen rate), Clients + Contacts, Config Items\n   - Normalize into: Client, Site, Contact, Ticket, Agreement, Device models\n\n2. **Immy.Bot Adapter** (PRIMARY - this is our \"desired state truth\")\n   - Pull: App baselines, Drift detection, Deployment compliance, Standardization compliance\n   - Normalize into: Device, Control/Standard (pass/fail + evidence)\n\n3. **Microsoft 365/Security Adapter**\n   - Pull: Entra ID sign-in risks, Defender for Endpoint signals, Defender for Office email security, Secure Score\n   - Normalize into: User, Risk, Control/Standard models\n\n### Normalized Data Model (Core Schema)\n\n**Entities:**\n- Client (id, name, segment, mrr, agreement_start, agreement_end)\n- Site (id, client_id, name, address)\n- Contact (id, client_id, role: CEO/CFO/IT/Office Manager, email, phone)\n- User (id, client_id, email, upn, mfa_enabled, risk_level)\n- Device (id, client_id, site_id, type: endpoint/server/network, os, managed, health_status)\n- Agreement (id, client_id, mrr, effective_rate, term)\n- Ticket (id, client_id, category, priority, status, hours, sla_met, reopen_count, csat)\n- Control (id, client_id, control_type, status: pass/fail/unknown, evidence, last_checked)\n- Risk (id, client_id, risk_type, likelihood, impact, status)\n- Recommendation (id, client_id, title, description, effort, cost_range, priority, quarter)\n\n### Scoring Engine (Three Scores \u2192 One Overall)\n\n**1. Standards Compliance Score (0-100)**\nInputs:\n- Device coverage (managed vs unmanaged %)\n- Immy desired state compliance\n- Patch compliance\n- EDR/AV coverage + health\n- M365 policy posture (Secure Score deltas)\n\n**2. Risk Score (0-100)**\nInputs:\n- Identity risk (Entra ID risky sign-ins, MFA gaps)\n- Email risk (Defender for Office signals)\n- Endpoint risk (Defender for Endpoint alerts)\n- Business risk modifiers\n\n**3. Experience Score (0-100)**\nInputs:\n- Tickets per user/device trend\n- Repeat issues (top 5 recurring problems)\n- SLA performance + reopen rate\n- After-hours incidents\n\n### OpenAI Integration (Tightly Scoped)\n\n**Four Jobs Only:**\n1. Trend spotting: \"What changed this quarter? What's getting worse?\"\n2. Narrative reporting: Convert metrics into plain English business outcomes\n3. Action synthesis: Turn findings into recommendations with owner/due date\n4. QBR prep: \"Here are the 6 most important things to discuss\"\n\n**Critical Guardrails:**\n- Use retrieval: only summarize what normalized data provides\n- Force citations/evidence (ticket IDs, device lists, policy states)\n- Ban hallucinations: reference only known fields\n- Human approval before client publish\n\n### QBR Output Requirements\n\n**Generate PDF with:**\n1. 1-page executive summary (plain English, business outcomes)\n2. Three scores (Standards/Risk/Experience) + what moved them\n3. Top 5 risks (with \"why it matters\" in business terms)\n4. Top 5 wins (what you did this quarter)\n5. Service experience story (ticket trends, recurring pain points)\n6. Security posture story (identity/email/endpoint unified)\n7. Lifecycle forecast (aging gear, refresh schedule, 12-36 month budget)\n8. Roadmap (Now/Next/Later format)\n9. Outcome plan (action items \u2192 owners \u2192 due dates)\n\n**Align to Sea-Level Ops QBR Structure:**\n- AM = relationship + business outcomes focus\n- TAM/Lead Tech = standards + technical hygiene\n- vCIO = roadmap + risk + lifecycle\n\n### Client Segmentation (Sea-Level \"5% rule\")\n\nEach client gets AM budget (time investment) based on % of agreement revenue.\n- Segment A/B: Quarterly QBR\n- Segment C: Semiannual\n- Segment D: Annual\n\nStore segment in Client model, use it to determine QBR cadence.\n\n### MVP Deliverables\n\n1. **Working API server** (Express) with routes:\n   - POST /sync/connectwise - Pull CW data\n   - POST /sync/immy - Pull Immy data\n   - POST /sync/m365 - Pull M365/security data\n   - GET /clients/:id/scores - Get current scores\n   - POST /clients/:id/qbr/generate - Generate QBR PDF\n\n2. **Database schema** (PostgreSQL migrations)\n   - All normalized entities\n   - Indexes for performance\n\n3. **Adapter modules** (src/adapters/)\n   - connectwise-adapter.js\n   - immy-adapter.js\n   - m365-adapter.js\n\n4. **Scoring engine** (src/engine/)\n   - standards-score.js\n   - risk-score.js\n   - experience-score.js\n\n5. **QBR generator** (src/qbr/)\n   - openai-narrative.js (with guardrails)\n   - pdf-generator.js\n\n6. **Configuration**\n   - .env.example with all required API keys\n   - config.js for settings\n   - README.md with setup instructions\n\n### Testing Strategy\n\n- Include sample/mock data for each adapter\n- End-to-end test: mock data \u2192 normalize \u2192 score \u2192 generate QBR PDF\n- Validate PDF output has all 9 required sections\n\n### What NOT to Build (Phase 1)\n\n- Multi-PSA support (just CW Manage)\n- Traditional RMM adapters (just Immy for now)\n- Automation workflows (pre/post QBR)\n- Client portal UI\n- Project/ticket auto-creation in PSA\n- Full lifecycle warranty tracking\n\nThis is Phase 1: prove the adapter pattern works, get ONE client's QBR generated end-to-end.",
  "working_directory": "/Users/name/homelab/etop-am-system-1282",
  "github_repo_name": null,
  "mode": "new_project",
  "enable_test_loop": false,
  "max_test_iterations": 3,
  "incremental": false,
  "flowise_flow": false,
  "project_type": null,
  "codebase_detection": {
    "has_code": false,
    "project_type": null,
    "languages": [],
    "has_git": false,
    "git_clean": null,
    "project_files": [],
    "confidence": "low"
  },
  "pause_after_phases": [],
  "execution_mode": "autonomous",
  "spec_files": [],
  "simple_mode": false,
  "target_phases": null,
  "build_profile": "standard",
  "phases_to_run": [
    "scout",
    "architect",
    "builder",
    "test",
    "documentation"
  ]
}